{% extends "layout/html.twig" %}
{% block extrastyles %}
    <link rel="stylesheet" type="text/css" href="{{ Url.media('media/css/map.css') }}"/>
{% endblock %}
{% block extrascripts %}
    <script type="text/javascript" src="{{ Url.media('media/js/map.js') }}"></script>
{% endblock extrascripts %}
{% block content %}
    <div class="stripe">
        <div class="wrap">
            <div class="ticket">
                <div class="title">
                    {{ "Этот день в истории"|i18n }}
                </div>
                <div class="today">{{ Date.translate('today','j') }}</div>
                <div class="month">{{ Date.translate('today', 'F') }}</div>
                <div class="holidays">
                    {% for item in day_in_history %}
                        <a href="{{ Url.site('calendar/event/'~item.id) }}">{{ item.title }}</a>
                    {% endfor %}
                </div>
                <a href="{{ Url.site('calendar/event/'~"now"|date('m/d')) }}">{{ "Другие даты"|i18n }}</a>
            </div>
            <div class="slider" id="top-slider">
                <div class="slides">
                    {% set slider_position = {'0': 't', '1': 'c', '2': 'b'} %}
                    {% for item in publications_slider %}
                        <div class="slide" id="slide{{ loop.index }}"><a href="{{ Url.site('publications/view/'~item.id) }}"><img src="{{ Url.media('/images/w393-h253-cc'~ slider_position[item.slider_position]  ~'-si/'~item.picture.file_path, TRUE) }}" alt="{{ item.title }}" title="{{ item.title }}"/></a></div>
                    {% endfor %}
                </div>
                <div class="ruler">
                    {% for item in publications_slider %}
                        <div class="rule"><a {% if loop.first %}class="active"{% endif %} href="#slide{{ loop.index }}">{{ item.title }}</a></div>
                    {% endfor %}
                </div>
            </div>
            <script type="text/javascript">
                function makeActiveSlide(id)
                {
                    var $ts = $('#top-slider');
                    var $slides = $('.slides', $ts);
                    var $slide = $(id, $ts);
                    $slide = $slide.detach();
                    $slides.prepend($slide);

                    return true;
                }

                function makeActiveNextSlide()
                {
                    var $active = $('.rule > a.active', '#top-slider');
                    var $rules = $('.rule > a');
                    $active.removeClass('active');
                    var index = ($rules.index($active)) + 2;
                    if (index > $rules.length) {
                        index = 1;
                    }
                    makeActiveSlide('#slide' + index);
                    $($rules.get(index - 1)).addClass('active');

                    return true;
                }

                $(document).ready(function ()
                {
                    var $ts = $('#top-slider');
                    var $rules = $('.rule > a', $ts);
                    $rules.on('click', function (e)
                    {
                        $('.rule > a', '#top-slider').removeClass('active');
                        $(this).addClass('active');
                        var id = $(this).attr('href');
                        makeActiveSlide(id);
                        clearInterval(mainSliderInterval);
                        mainSliderInterval = setInterval(makeActiveNextSlide, 6000);
                        e.preventDefault();
                    });
                    var mainSliderInterval = setInterval(makeActiveNextSlide, 6000);
                });
            </script>
        </div>
    </div>
    <div class="debates">
        <div class="wrap">
            <h2><a href="{{ Url.site('publications') }}"><span>{{ "Publications"|i18n }}</span></a></h2>
            {% for item in publications %}
                <div class="column{% if loop.last %} last{% endif %}">
                    <a href="{{ Url.site('publications/view/'~item.id) }}" class="h3">{{ item.title }}</a>
                    <div class="image"><img {% if item.carved_id==0 %}src='{{ Url.media('/images/w280-h186-cc'~ slider_position[item.slider_position]  ~'-si/'~item.picture.file_path, TRUE) }}' {% else %} src='{{ Url.media(item.carved.file_path) }}'{% endif %} alt="{{ item.title }}" title="{{ item.title }}"/></div>
                    <div class="desc">{{ item.desc|striptags }}</div>
                  <!--  <div class="date">{{ Date.ru_date(item.date, 'd.m.Y') }}</div>-->
                </div>
            {% endfor %}
            <div class="clear"></div>
        </div>
    </div>
    <div class="interactive-map">
        <div class="wrap">
            <h2>{{ "Interactive map"|i18n }}</h2>

            <div id="map-main-block" class="locate-map">
                <div id="map-active"></div>
                <div id="map-not-active"></div>
                
                <div id="kostanay-hover" class="hover-area"></div>
                <div id="aqtobe-hover" class="hover-area"></div>
                <div id="pavlodar-hover" class="hover-area"></div>
                <div id="vko-hover" class="hover-area"></div>
                <div id="almaty-hover" class="hover-area"></div>
                <div id="karagandy-hover" class="hover-area"></div>
                <div id="akmola-hover" class="hover-area"></div>
                <div id="sko-hover" class="hover-area"></div>
                <div id="zko-hover" class="hover-area"></div>
                <div id="atiray-hover" class="hover-area"></div>
                <div id="mangistay-hover" class="hover-area"></div>
                <div id="kizilorda-hover" class="hover-area"></div>
                <div id="jambyl-hover" class="hover-area"></div>
                <div id="yuko-hover" class="hover-area"></div>
                
                <div id="kostanay-label" class="map-label">{{ "Kostanay region"|i18n }}</div>
                <div id="sko-label" class="map-label">{{ "North Kazakhstan region"|i18n }}</div>
                <div id="akmola-label" class="map-label">{{ "Akmola region"|i18n }}</div>
                <div id="pavlodar-label" class="map-label">{{ "Pavlodar region"|i18n }}</div>
                <div id="vko-label" class="map-label">{{ "East Kazakhstan region"|i18n }}</div>
                <div id="almaty-label" class="map-label">{{ "Almaty region"|i18n }}</div>
                <div id="zhambyl-label" class="map-label">{{ "Zhambyl region"|i18n }}</div>
                <div id="yko-label" class="map-label">{{ "South Kazakhstan region"|i18n }}</div>
                <div id="karaganda-label" class="map-label">{{ "Karaganda region"|i18n }}</div>
                <div id="kyzylorda-label" class="map-label">{{ "Kyzylorda region"|i18n }}</div>
                <div id="aktobe-label" class="map-label">{{ "Aktobe region"|i18n }}</div>
                <div id="zko-label" class="map-label">{{ "West Kazakhstan region"|i18n }}</div>
                <div id="atyrau-label" class="map-label">{{ "Atyrau region"|i18n }}</div>
                <div id="mangistau-label" class="map-label">{{ "Mangystau region"|i18n }}</div>
                
                <img id="is-map"  src="{{ Url.media('media/images/maps/transparent-map.png') }}" alt="" usemap="#imgmap" />
                
                <map name="imgmap" id="mapping">
                    <area shape="poly" data-region="pavlodar" coords="614,80,608,62,623,55,649,46,651,36,666,24,679,20,679,31,674,36,696,51,742,107,721,129,734,147,735,161,723,169,716,164,713,154,698,151,690,159,677,167,669,167,655,177,655,169,646,164,630,156,624,144,620,134,627,124,622,119,627,105,623,95" href="#" alt="1" />
                    <area shape="poly" data-region="vko" coords="718,168,733,167,735,153,722,133,728,123,737,113,740,107,766,140,777,117,788,123,795,135,807,129,817,129,821,123,831,120,834,113,851,119,863,140,877,140,888,155,912,155,920,145,927,155,938,158,926,166,933,173,926,184,910,193,911,214,917,234,910,243,901,253,897,245,879,252,866,248,861,246,855,257,853,282,852,308,838,294,828,273,814,277,798,277,790,268,780,276,768,270,754,270,740,268,729,270,716,258,722,246,708,228,714,222,709,199,708,181" href="#" alt="2" />
                    <area shape="poly" data-region="almaty" coords="642,327,670,300,696,296,723,295,728,288,726,276,743,267,762,271,777,275,788,267,801,277,823,273,829,288,844,298,858,312,861,324,844,323,839,318,802,335,798,349,810,347,809,360,821,384,829,402,820,418,819,431,807,427,798,429,791,419,775,419,740,424,732,420,727,426,707,424,698,429,698,418,686,400,685,384,665,377,661,365,652,362,647,349" href="#" alt="3" />
                    <area shape="poly" data-region="karagandy" coords="377,291,409,266,404,256,420,241,423,228,438,235,447,229,462,220,462,209,483,190,483,181,496,173,507,161,517,166,533,175,550,180,559,168,576,158,579,170,599,160,614,146,620,139,625,154,637,160,652,166,653,177,664,171,680,166,695,151,708,154,715,165,707,178,708,191,708,202,713,215,708,229,722,239,717,254,717,271,727,281,724,294,695,296,669,299,653,316,644,326,487,334,477,325,469,325,453,332,443,328,432,318,408,310,387,300" href="#" alt="4" />
                    <area shape="poly" data-region="akmola" coords="441,122,458,105,478,106,484,98,491,103,510,85,506,70,515,58,532,58,544,71,548,66,569,68,578,80,595,77,602,85,617,87,623,104,622,117,624,127,619,135,602,154,579,168,578,156,561,165,555,181,530,172,512,159,493,167,477,166,472,158,460,158,454,151,445,150,443,138" href="#" alt="5" />
                    <area shape="poly" data-region="sko" coords="458,95,462,70,458,43,460,25,495,14,508,3,516,0,541,7,552,0,557,14,560,28,558,40,579,35,588,45,604,43,617,44,608,55,610,73,617,85,599,83,595,77,579,81,570,69,547,65,546,73,533,59,524,59,504,68,510,83,500,94,486,104,469,104" href="#" alt="6" />
                    <area shape="poly" data-region="kostanay" coords="355,138,350,132,346,135,341,127,331,126,325,116,334,109,345,104,339,91,352,77,364,82,371,78,349,66,350,46,356,40,363,46,392,45,399,38,415,37,438,36,439,30,458,25,461,43,463,60,457,79,457,104,439,126,444,150,458,157,469,157,480,169,495,170,486,187,466,201,464,217,449,226,441,235,425,227,416,241,407,251,393,242,378,228,369,216,367,205,383,190,378,170,368,151" href="#" alt="7" />
                    <area shape="poly" data-region="aqtobe" coords="171,184,181,180,195,175,196,147,199,131,219,152,232,144,248,137,257,141,273,141,288,141,289,151,303,157,315,165,320,154,328,158,350,157,355,139,365,149,372,160,380,179,381,188,366,201,367,218,380,232,396,243,405,257,408,266,375,290,363,269,348,263,336,264,330,282,314,282,295,300,274,319,265,334,223,342,217,319,219,299,211,291,193,278,189,259,199,246,192,230,198,213,187,204,181,212,178,205,178,196" href="#" alt="8" />
                    <area shape="poly" data-region="zko" coords="1,181,10,167,21,159,14,153,19,134,31,134,34,120,47,119,52,144,67,143,65,119,81,116,84,104,98,108,119,93,138,99,151,98,152,108,175,111,184,127,194,149,191,172,172,178,166,192,152,190,143,203,138,210,121,195,106,196,99,203,89,200,75,206,63,210,44,199,21,195,12,194" href="#" alt="9" />
                    <area shape="poly" data-region="atiray" coords="37,264,29,251,42,255,38,235,32,221,31,213,18,207,9,211,9,200,34,196,59,208,68,209,87,201,103,201,109,195,122,195,135,208,147,201,150,191,161,193,172,187,181,195,176,199,181,212,189,207,198,212,194,224,193,241,193,254,190,263,192,277,206,291,218,301,217,311,189,294,172,294,137,299,142,283,141,269,128,259,117,265,100,252,79,255,58,261" href="#" alt="10" />
                    <area shape="poly" data-region="mangistay" coords="135,303,155,297,175,294,191,298,217,312,219,333,220,344,203,343,199,350,182,475,167,478,156,459,155,446,137,433,105,432,92,447,92,433,98,421,97,407,82,401,79,391,69,388,71,377,67,354,56,333,70,335,86,343,78,327,89,317,99,313,113,321,136,329,153,330,147,340,160,337,161,327,155,320,138,323,134,309" href="#" alt="11" />
                    <area shape="poly" data-region="kizilorda" coords="268,330,276,318,297,301,314,283,329,282,338,261,355,264,369,286,382,295,399,307,422,316,438,324,460,331,468,328,480,331,481,349,485,366,487,380,489,396,497,406,495,417,496,431,478,442,448,463,451,435,443,443,435,428,421,410,408,418,374,413,350,416,338,413,326,390,322,378" href="#" alt="12" />
                    <area shape="poly" data-region="jambyl" coords="531,333,640,325,648,352,664,372,681,385,687,404,696,428,677,430,660,420,646,430,649,452,633,446,609,439,587,440,578,459,562,452,554,432,538,418,548,401,536,362" href="#" alt="13" />
                    <area shape="poly" data-region="yuko" coords="451,465,479,442,498,433,493,423,503,416,500,401,489,390,491,369,482,354,485,332,531,334,539,362,546,391,540,419,551,430,560,449,575,462,572,474,565,471,554,483,544,481,538,492,521,506,517,522,506,511,504,502,492,502,474,507,466,496,466,479" href="#" alt="14" />
                </map>
                
                <div class="area" id="area"></div>
                
                <div id="closemap"></div>
            </div>
            <script type="text/javascript">
                $(document).ready(function ()
                {
                    $('.city-item').popover();

                    var regions = [
                        'pavlodar',
                        'vko',
                        'almaty',
                        'karagandy',
                        'akmola',
                        'sko',
                        'zko',
                        'kostanay',
                        'mangistay',
                        'aqtobe',
                        'kizilorda',
                        'jambyl',
                        'yuko'
                    ];
                    
                    for (var i = 0; i < regions.length; i++) {
                        var img = new Image();
                        img.src = '{{ Url.media('media/theme/areas/') }}/' + regions[i] + '.png';
                    }

                    $('#mapping area').on('click', function (e)
                    {
                        $(".city-item").remove();
                        var region = $(this).data('region');
                        var image = '{{ Url.media('media/theme/areas/') }}/' + region + '.png';
                        $('#area').css('background-image', 'url(' + image + ')').fadeIn(400);
                        $.ajax({
                            url     : "{{ Url.site('ajax/points') }}",
                            type    : "POST",
                            dataType: "json",
                            data    : { 'region': region },
                            success : function (data)
                            {
                                for (var i = 0; i < data.length; i++) {
                                    var view = '{{ Url.site('map/view') }}' + '/' + data[i]['id'];
                                    var name = data[i]['name'];
                                    var desc = data[i]['desc'];
                                    var x = data[i]['x'];
                                    var y = data[i]['y'];
                                    var img = data[i]['img'];
                                    var marker = data[i]['marker'];
                                    var markerurl = '{{ Url.media('media/theme/markers') }}' + '/' + marker + '.png';
                                    var html = '<a href="' + view + '" rel="tooltip" class="city-item" data-trigger="hover" data-html="true" data-placement="top" data-title="' + name + '" data-content="' + img + '<br /> ' + desc + '" style="margin-top : ' + y + 'px; margin-left : ' + x + 'px;">' + /* name + */'<div style="margin: 0 auto 0; width: 24px; height: 24px; background: transparent url('+markerurl+') no-repeat scroll 0 0;"></div></a>';
                                    $('#area').append(html);
                                }
                                $('.city-item').popover();
                            }
                        });

                        e.preventDefault();
                    });
                });
            </script>
        </div>
    </div>
    
    <div class="experts">
        <div class="wrap">
            <h2><a href="{{ Url.site('expert') }}"><span>{{"Expert opinion"|i18n}}</span></a></h2>
            {% for item in expert_opinions %}
            <div class="column{% if loop.last %} last{% endif %}">
                <a href="{{ Url.site('expert/view/'~item.id) }}" class="h3">{{ item.title|raw }}</a>
                <div class="desc">{{ item.description|raw|striptags }}</div>
                <div class="date">{{ Date.ru_date(item.date, 'd.m.Y') }}, {{ item.comments_count }} {{ CorrectDeclension.give(item.comments_count)|i18n }}</div>
            </div>
            {% endfor %}
            <div class="clear"></div>
            <hr/>
        </div>
    </div>
    <div class="debates">
        <div class="wrap">
            <h2><a href="{{ Url.site('briefings/index') }}"><span>{{ "Briefings"|i18n }}</span></a></h2>
            {% for briefing in briefings %}
                <div class="column{% if loop.last %} last{% endif %}">
                    <a href="{{ Url.site('briefings/view/'~briefing.id) }}" class="h3">{{ briefing.title }}</a>
                    {% if not briefing.link is empty %}
                        <div class="desc video"><a href="{{ Url.site('briefings/view/'~briefing.id) }}"><img src="http://img.youtube.com/vi/{{ briefing.link }}/0.jpg" alt="{{ briefing.title }}" title="{{ briefing.title }}" /></a></div>
                    {% else %}
                        <div class="desc">{{ briefing.desc|raw|striptags }}</div>
                    {% endif %}
                   <!-- <div class="date">{{ Date.ru_date(briefing.date, 'd.m.Y') }}, {{ briefing.publComments(briefing.id) }} {{ CorrectDeclension.give(briefing.publComments(briefing.id))|i18n }}</div>-->
                </div>
            {% endfor %}
            <div class="clear"></div>
        </div>
    </div>
    
    <a name="chronology"></a>
    <div class="chronology">
        <div class="wide-wrap">
            <div class="wrap">
                <h2>{{ "Chronology of events"|i18n }}</h2>
                <div class="periods">
                    {% for era in list_era %}
                        <a href="#chronology" class="list_era{% if loop.index==5 %} active{% endif %}" onclick="new_era('{{ loop.index-1 }}',0);" id="era_{{ loop.index-1 }}"><span>{{ era.name }}</span></a>
                    {% endfor %}
                </div>
            </div>
            <div id="timeline">
                <a href="#chronology" id="prev-page" class="arrows"></a>
                <div class="pages">
                    <div class="page" id="middle-ages">
                        <div class="bars">
                            {% for period in list_period %}
                                <div class="bar" style="margin-left: {{ period.value|split(';')[0] }}%; width: {{ period.value|split(';')[1]-period.value|split(';')[0] }}%;">{{ period.name }} ({{ period.start }} - {{ period.finish }})</div>
                            {% endfor %}
                        </div>
                        <div class="line">
                            <div class="mark" style="margin-left: {{ 940*20/100 }}px"></div>
                            <div class="mark" style="margin-left: {{ 940*40/100 }}px"></div>
                            <div class="mark" style="margin-left: {{ 940*60/100 }}px"></div>
                            <div class="mark" style="margin-left: {{ 940*80/100 }}px"></div>
                        </div>
                        <div class="keypoints">
                            {% set i = 0 %}
                            {% if list_event|length!=0 %}
                                {% set m_in = 240/list_event|length %}
                            {% else %}
                                {% set m_in = 0 %}
                            {% endif %}
                            {% for item in list_event %}
                                <div class="keypoint" style="margin-left: {{ (9.4*item.line_x)|replace({',':'.'}) }}px;">
                                    <div class="info" style="margin-top: {{ i*m_in }}px" onclick="view_event({{ item.id }});">
                                        <div class="text"><strong>{{ item.date }}</strong> {{ item.title }}</div>
                                        {% if item.picture.file_path is defined %}
                                            <div class="image"><img src="{{ Url.media('/images/w276-cct-si/'~item.picture.file_path, TRUE) }}" alt="{{ item.title }}" title="{{ item.title }}"/></div>
                                        {% else %}
                                            <div class="image">{{ item.description }}</div>
                                        {% endif %}
                                    </div>
                                </div>
                                {% set i = i + 1 %}
                            {% endfor %}
                        </div>
                    </div>
                </div>
                <a href="#chronology" id="next-page" class="arrows"></a>
            </div>
        </div>
        <div id="view-event" class="modal fade hide" style="max-height: 1000px; color: #333;">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 id="view-event-head" style="color: #333"></h4>
            </div>
            <div class="modal-body" id="view-event-text">
            </div>
        </div>
    </div>
    <div class="biography">
        <div class="wrap">
            <h2><a href="{{ Url.site('biography') }}"><span>{{ "Personalia"|i18n }}</span></a></h2>
            {% for item in biography %}
                <div class="column{% if loop.last %} last{% endif %}">
                    <a href="{{ Url.site('biography/view/'~item.id) }}"><img class="face" src="{{ Url.media('/images/w119-h165-cct-si/'~item.picture.file_path, TRUE) }}" alt="{{ item.name }}" title="{{ item.name }}"/></a>
                    <div class="name"><a href="{{ Url.site('biography/view/'~item.id) }}"><span>{{ item.name }}</span></a></div>
                    <div class="years">{% if not item.date_start is empty %}{{ item.date_start }}{% if not item.date_finish is empty %} — {{ item.date_finish }}{% endif %}{% endif %}</div>
                </div>
            {% endfor %}
            <div class="clear"></div>
        </div>
    </div>
    
    <div class="debates">
        <div class="wrap">
            <h2><a href="{{ Url.site('debate') }}"><span>{{ "Debate"|i18n }}</span></a></h2>

            {% for item in debate %}
                <div class="column{% if loop.last %} last{% endif %}">
                    <a href="{{ Url.site('debate/view/'~item.id) }}" class="h3">«{{ item.title }}»</a>
                    <div class="desc">{{ Text.limit_chars(item.description,300)|raw|striptags }}</div>
                   <!-- <div class="date">{{ Date.ru_date(item.start_time, 'd.m.Y') }}, {{ item.comments_count }} {{ CorrectDeclension.give(item.comments_count)|i18n }}</div>-->
                
		</div>
            {% endfor %}
            <div class="clear"></div>
        </div>
    </div>
    <div class="video" id="video-tabs">
        <div class="wrap">
            <h2><a href="{{ Url.site('multimedia') }}"><span>{{ "Мультимедиа"|i18n }}</span></a></h2>
            <div class="tabs">
                <a href="#panel-photo" class="tab active">{{ "Photosets"|i18n }}</a>
                <a href="#panel-video" class="tab">{{ "Video"|i18n }}</a>
                <a href="#panel-audio" class="tab">{{ "Audio"|i18n }}</a>
                <a href="#panel-info" class="tab">{{ "Infographics"|i18n }}</a>
            </div>
            <div class="panel active" id="panel-photo">
                {% for photoset in photosets %}
                    <div class="column {% if loop.last %}last{% endif %}">
                        <div class="photop">
                        <div class="image"><a href="{{ Url.site('photosets/view/'~photoset.id) }}"><img src="{{ Url.media('images/w280-h200-ccc-si/' ~photoset.file_path) }}" alt="{{ photoset.name }}" title="{{ photoset.name }}"/></a></div>
                            </div>
                        <a href="{{ Url.site('photosets/view/'~photoset.id) }}">{{ photoset.name() }}</a>
                        <div class="date">{{ Date.translate(photoset.date, 'd F Y') }}</div>
                    </div>
                {% endfor %}
                <div class="clear"></div>
            </div>
            <div class="panel" id="panel-video">
            {% for entry in video %}
                <div class="column {% if loop.last %}last{% endif %}">
                    <div class="image"><a class="fancybox" href="http://www.youtube.com/embed/{{ entry.link }}?feature=player_detailpage"><img width="280" height="186" src="http://img.youtube.com/vi/{{entry.link}}/1.jpg" title="{{ entry.title }}"/></a></div>
                    <a class="fancybox" href="http://www.youtube.com/embed/{{ entry.link }}?feature=player_detailpage">{{ entry.title }}</a>
                    <div class="date">{{ Date.translate(entry.date, 'd F Y') }}</div>
                    </div>
            {% endfor %}
                <div class="clear"></div>
                </div>
            <div class="panel" id="panel-audio">
                {% for item in audio %}
                    <div class="item">
                        <a href="{{ Url.media(item.mp3.file_path) }}" class="jouele">
                            {{ item.title }} ({{ item.rubric }})
                        </a>
                    </div>
                    <div class="clear"></div>
                {% endfor %}
            </div>
            <div class="panel" id="panel-info">
                {% for infograph in infographs %}
                    <div class="column {% if loop.last %}last{% endif %}">
                        <div class="infograph">
                            <div class="image"><a href="{{ Url.site('infographs/view/'~infograph.id) }}"><img src="{{ Url.media('/images/w280-h225-ccc-si/'~infograph.picture.file_path, TRUE) }}" alt="{{ infograph.title }}" title="{{ infograph.title }}"/></a></div>
                            <a href="{{ Url.site('infographs/view/'~infograph.id) }}">{{ infograph.title }}</a>
                        </div>
                    </div>
                {% endfor %}
                <div class="clear"></div>
              </div>
        </div>
        <script type="text/javascript">
            $(document).ready(function(){
                $('#video-tabs .tabs .tab').on('click', function(e){
                    var panel = $(this).attr('href');
                    $('#video-tabs .tabs .tab').removeClass('active');
                    $(this).addClass('active');
                    $('#video-tabs .panel').removeClass('active');
                    $(panel).addClass('active');
                    e.preventDefault();
                });
            });
        </script>
    </div>
    <script type="text/javascript">

        var n_id = 4;
        var n_old = 0;
        $('#next-page').click(function (e)
        {
            n_old++;
            new_era(n_id, n_old);
            e.preventDefault();
        });
        $('#prev-page').click(function (e)
        {
            n_old--;
            new_era(n_id, n_old);
            e.preventDefault();
        });

        function view_event(id)
        {
            $.ajax({
                url     : "{{ Url.media('ajax/event') }}",
                type    : "POST",
                dataType: "json",
                data    : { 'id': id, 'language': '{{ _language }}' },
                success : function (data)
                {
                    $("#view-event-head").empty();
                    $("#view-event-head").text(data['title']+' ('+data['date']+')');
                    $("#view-event-text").empty();
                    var image = '';
                    if (data['image']!=0)
                    {
                        image = '<div style="text-align: center"><img src="'+data['image']+'" alt=""/></div>'
                    }
                    $("#view-event-text").append(image+'<div><i>'+data['description']+'</i></div><div>'+data['text']+'</div><a href="{{ Url.site('chronology/event') }}/'+data['id']+'">{{ "Read more"|i18n }}</a>');

                    $("#view-event").modal('show');
                },
                error   : function ()
                {
                   // alert('error')
                }
            });

            return false;
        }


        function new_era(id, old)
        {
            $.ajax({
                url     : "{{ Url.media('ajax/era') }}",
                type    : "POST",
                dataType: "json",
                data    : { 'id': id, 'old': old, 'language': '{{ _language }}'},
                success : function (data)
                {
                    n_old = data['new_old'];
                    n_id = data['new_id'];
                    $('.list_era').removeClass('active');
                    $('#era_' + n_id).addClass('active');
                    if (!data['finish'] && n_old>=0) {
                        $('.bars').empty();
                        $.each(data['period'], function (i, value)
                        {
                            $('.bars').append('<div class="bar" style="margin-left:' + value['left'] + '%; width:' + (value['width'] - value['left']) + '%;">' +
                                    value['name'] + ' ' + value['date'] + '</div>');
                        });
                        $('.keypoints').empty();
                        var m_in = 0;
                        if (data['events'].length != 0) {
                            m_in = 180 / data['events'].length;
                        }
                        $.each(data['events'], function (i, value)
                        {
                            $('.keypoints').append('<div class="keypoint" style="margin-left:' + (940 * value['line_x'] / 100) + 'px;">' +
                                    '<div class="info" style="margin-top: ' + (i * m_in) + 'px" onclick="view_event('+value['id']+');">' +
                                    '<div class="text"><strong>' + value['date'] + '</strong> ' + value['title'] + '</div>' +
                                    '<div class="image">' + value['picture'] + '</div>' + '</div></div>');

                        });
                    }
                    else if (n_old<0){
                        n_old = 0;
                    }
                },
                error   : function ()
                {
                    //alert('error')
                }
            });

            return false;
        }
    </script>
{% endblock content %}
